{% extends "base_header.html" %}

{% block title %}GR8DATE • Edit Profile{% endblock %}

{% block content %}
</div>
<style>
:root{--brand:#ff2b6a;--brand-900:#e11e5a;--ink:#0f172a;--muted:#64748b;--bg:#f6f7fb;--card:#fff;--border:#eaeef5;--shadow:0 10px 26px rgba(15,23,42,.08)}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink)}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
.container{max-width:1120px;margin:24px auto;padding:0 16px 80px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:760px){.grid-2{grid-template-columns:1fr}}
.field{display:flex;flex-direction:column;gap:6px}
.field input,.field select,.field textarea{border:1px solid var(--border);border-radius:10px;padding:12px;background:#fff}
.read-only{background:#fbfbfd}
.btn{display:inline-flex;align-items:center;gap:8px;border-radius:9999px;padding:.7rem 1.1rem;border:2px solid transparent;font-weight:700;cursor:pointer}
.btn-primary{background:var(--brand);color:#fff;border-color:var(--brand)}
.btn-primary:hover{background:var(--brand-900);border-color:var(--brand-900)}
.btn-muted{background:#f2f4f7;border:1px solid var(--border);color:#111}

/* SIMPLIFIED TAB SYSTEM */
.mobile-tabs{display:flex;background:#f8f9fa;padding:8px;border-radius:12px;margin-bottom:20px;border:1px solid var(--border)}
.tab-button{flex:1;padding:12px 16px;border:none;background:transparent;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:6px}
.tab-button.active{background:white;box-shadow:0 2px 8px rgba(0,0,0,.1);border:1px solid var(--border);color:var(--brand)}
.tab-button:not(.active):hover{background:rgba(255,255,255,0.7)}
.tab-content{display:none}
.tab-content.active{display:block}

/* Badges & Status */
.badge{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600;margin-left:8px}
.badge-instant{background:#dcfce7;color:#166534}
.badge-pending{background:#fef3c7;color:#92400e}

/* PHOTO STYLES */
.photo-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.photo-item{position:relative;width:100%;aspect-ratio:1/1;border-radius:10px;overflow:hidden;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;background:#f0f0f0}
.photo-item img{width:100%;height:100%;object-fit:cover}
.photo-count{font-size:12px;color:#64748b;margin-top:6px}

/* DELETE BUTTON STYLES */
.btn-delete {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 24px;
    height: 24px;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    transition: all 0.2s ease;
}
.btn-delete:hover {
    background: #cc0000;
    transform: scale(1.1);
}

/* UPLOAD TRIGGER */
.photo-upload-trigger {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 20px;
    border: 2px dashed #667eea;
    border-radius: 12px;
    background: #f8faff;
    cursor: pointer;
    transition: all 0.3s ease;
    height: 100%;
    min-height: 120px;
}
.photo-upload-trigger:hover {
    background: #f0f4ff;
    border-color: #5a6fd8;
}
.upload-icon {
    font-size: 32px;
    color: #667eea;
}
.upload-text {
    text-align: center;
}
.upload-text h4 {
    margin: 0 0 4px 0;
    color: #334155;
    font-size: 16px;
}
.upload-text p {
    margin: 0;
    font-size: 14px;
    color: #64748b;
}

/* TAG OPTIONS STYLES */
.tag-options{display:flex;flex-wrap:wrap;gap:8px;border:1px solid var(--border);border-radius:10px;padding:12px;background:var(--bg-muted);min-height:60px}
.tag-option{display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s}
.tag-option:hover{border-color:#667eea;background:#f0f4ff}
.tag-option input[type="checkbox"]{margin-right:6px}
.tag-option input[type="checkbox"]:checked + span{font-weight:bold;color:#667eea}

.badge-note{font-size:12px;color:#64748b;margin-top:6px}

/* SAVE ACTIONS */
.save-actions{display:flex;flex-direction:column;gap:12px;margin-top:20px;padding:16px;background:#f8f9fa;border-radius:12px;border:1px solid #eaeef5}
.save-main{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center}

/* ERROR STYLES */
.error-message{color:#dc2626;font-size:12px;margin-top:4px}
.success-message{color:#166534;font-size:12px;margin-top:4px}
</style>

<main class="container">
  <!-- SIMPLIFIED TAB SYSTEM -->
  <div class="mobile-tabs">
    <button class="tab-button active" data-tab="preferences">
      <span class="material-icons" style="font-size:18px">flash_on</span>
      Lifestyle & Compatibility
    </button>
    <button class="tab-button" data-tab="profile">
      <span class="material-icons" style="font-size:18px">edit</span>
      Profile & Photos
    </button>
  </div>

  <!-- REAL FORM -->
  <form id="profileForm" method="post" novalidate>
    {% csrf_token %}

    <!-- Clean header -->
    <div class="card" style="margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <h1 style="margin:0;font-size:22px">Edit My Profile</h1>
    </div>

    <!-- PREFERENCES TAB CONTENT -->
    <div class="tab-content active" id="preferences-tab">
      <section class="card">
        <div class="section-header" style="display:flex;align-items:center;margin-bottom:8px">
          <h3 style="margin:0">⚡ Lifestyle & Compatibility</h3>
          <span class="badge badge-instant">
            <span class="material-icons" style="font-size:14px">flash_on</span>
            Updates Immediately
          </span>
        </div>
        
        <div class="grid-2">
          <!-- Physical Attributes -->
          <div class="field">
            <label for="body_type">Body Type</label>
            <select id="body_type" name="body_type">
              <option value="">Select body type</option>
              <option value="slim" {% if me.body_type == 'slim' %}selected{% endif %}>Slim</option>
              <option value="athletic" {% if me.body_type == 'athletic' %}selected{% endif %}>Athletic</option>
              <option value="average" {% if me.body_type == 'average' %}selected{% endif %}>Average</option>
              <option value="curvy" {% if me.body_type == 'curvy' %}selected{% endif %}>Curvy</option>
              <option value="stocky" {% if me.body_type == 'stocky' %}selected{% endif %}>Stocky</option>
            </select>
          </div>

          <!-- Relationship & Family -->
          <div class="field">
            <label for="relationship_status">Relationship Status</label>
            <select id="relationship_status" name="relationship_status">
              <option value="">Select status</option>
              <option value="single" {% if me.relationship_status == 'single' %}selected{% endif %}>Single</option>
              <option value="divorced" {% if me.relationship_status == 'divorced' %}selected{% endif %}>Divorced</option>
              <option value="separated" {% if me.relationship_status == 'separated' %}selected{% endif %}>Separated</option>
              <option value="widowed" {% if me.relationship_status == 'widowed' %}selected{% endif %}>Widowed</option>
            </select>
          </div>

          <div class="field">
            <label for="children">Do you have children?</label>
            <select id="children" name="children">
              <option value="">Select</option>
              <option value="none" {% if me.children == 'none' %}selected{% endif %}>No children</option>
              <option value="yes_live_with_me" {% if me.children == 'yes_live_with_me' %}selected{% endif %}>Yes, live with me</option>
              <option value="yes_not_with_me" {% if me.children == 'yes_not_with_me' %}selected{% endif %}>Yes, don't live with me</option>
            </select>
          </div>

          <div class="field">
            <label for="want_children">Want children?</label>
            <select id="want_children" name="want_children">
              <option value="">Select</option>
              <option value="want" {% if me.want_children == 'want' %}selected{% endif %}>Want children</option>
              <option value="dont_want" {% if me.want_children == 'dont_want' %}selected{% endif %}>Don't want children</option>
              <option value="not_sure" {% if me.want_children == 'not_sure' %}selected{% endif %}>Not sure</option>
              <option value="open" {% if me.want_children == 'open' %}selected{% endif %}>Open to it</option>
            </select>
          </div>

          <div class="field">
            <label for="ethnicity">Ethnicity</label>
            <select id="ethnicity" name="ethnicity">
              <option value="">Select ethnicity</option>
              <option value="asian" {% if me.ethnicity == 'asian' %}selected{% endif %}>Asian</option>
              <option value="black" {% if me.ethnicity == 'black' %}selected{% endif %}>Black</option>
              <option value="caucasian" {% if me.ethnicity == 'caucasian' %}selected{% endif %}>Caucasian</option>
              <option value="hispanic" {% if me.ethnicity == 'hispanic' %}selected{% endif %}>Hispanic</option>
              <option value="mixed" {% if me.ethnicity == 'mixed' %}selected{% endif %}>Mixed</option>
              <option value="middle_eastern" {% if me.ethnicity == 'middle_eastern' %}selected{% endif %}>Middle Eastern</option>
              <option value="native" {% if me.ethnicity == 'native' %}selected{% endif %}>Native/Indigenous</option>
              <option value="pacific_islander" {% if me.ethnicity == 'pacific_islander' %}selected{% endif %}>Pacific Islander</option>
              <option value="prefer_not_say" {% if me.ethnicity == 'prefer_not_say' %}selected{% endif %}>Prefer not to say</option>
            </select>
          </div>

          <!-- Lifestyle Habits -->
          <div class="field">
            <label for="smoking">Smoking</label>
            <select id="smoking" name="smoking">
              <option value="">Select</option>
              <option value="non_smoker" {% if me.smoking == 'non_smoker' %}selected{% endif %}>Non-smoker</option>
              <option value="social_smoker" {% if me.smoking == 'social_smoker' %}selected{% endif %}>Social smoker</option>
              <option value="light_smoker" {% if me.smoking == 'light_smoker' %}selected{% endif %}>Light smoker</option>
              <option value="regular_smoker" {% if me.smoking == 'regular_smoker' %}selected{% endif %}>Regular smoker</option>
            </select>
          </div>

          <div class="field">
            <label for="drinking">Drinking</label>
            <select id="drinking" name="drinking">
              <option value="">Select</option>
              <option value="non_drinker" {% if me.drinking == 'non_drinker' %}selected{% endif %}>Non-drinker</option>
              <option value="social_drinker" {% if me.drinking == 'social_drinker' %}selected{% endif %}>Social drinker</option>
              <option value="regular_drinker" {% if me.drinking == 'regular_drinker' %}selected{% endif %}>Regular drinker</option>
            </select>
          </div>

          <!-- Looking For Preferences -->
          <div class="field">
            <label>I'm looking for</label>
            <input class="read-only" value="{{ me.get_looking_for_display }}" readonly>
            <small class="helper">Cannot be changed after creation</small>
          </div>

          <!-- Intent Preference -->
          <div class="field">
            <label>Intent</label>
            <select id="prefIntent" name="preferred_intent">
              <option value="any" {% if me.preferred_intent == 'any' %}selected{% endif %}>Any</option>
              <option value="friends" {% if me.preferred_intent == 'friends' %}selected{% endif %}>New friends</option>
              <option value="casual" {% if me.preferred_intent == 'casual' %}selected{% endif %}>Casual dating</option>
              <option value="longterm" {% if me.preferred_intent == 'longterm' %}selected{% endif %}>Long-term</option>
              <option value="marriage" {% if me.preferred_intent == 'marriage' %}selected{% endif %}>Marriage</option>
            </select>
          </div>
        </div>

        <!-- Interests & Hobbies -->
        <div class="field" style="grid-column:1/-1">
          <label>My Interests & Hobbies</label>
          <div class="tag-options">
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="dining_out" id="interest_dining" {% if 'dining_out' in me.my_interests %}checked{% endif %}>
              <span>Dining Out</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="travel" id="interest_travel" {% if 'travel' in me.my_interests %}checked{% endif %}>
              <span>Travel</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="fitness" id="interest_fitness" {% if 'fitness' in me.my_interests %}checked{% endif %}>
              <span>Fitness</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="movies" id="interest_movies" {% if 'movies' in me.my_interests %}checked{% endif %}>
              <span>Movies & Cinema</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="music" id="interest_music" {% if 'music' in me.my_interests %}checked{% endif %}>
              <span>Live Music</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="cooking" id="interest_cooking" {% if 'cooking' in me.my_interests %}checked{% endif %}>
              <span>Cooking</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="beach" id="interest_beach" {% if 'beach' in me.my_interests %}checked{% endif %}>
              <span>Beach</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="hiking" id="interest_hiking" {% if 'hiking' in me.my_interests %}checked{% endif %}>
              <span>Hiking & Nature</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="sports" id="interest_sports" {% if 'sports' in me.my_interests %}checked{% endif %}>
              <span>Sports</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="art_culture" id="interest_art" {% if 'art_culture' in me.my_interests %}checked{% endif %}>
              <span>Art & Culture</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="gaming" id="interest_gaming" {% if 'gaming' in me.my_interests %}checked{% endif %}>
              <span>Gaming</span>
            </label>
            <label class="tag-option">
              <input type="checkbox" name="my_interests" value="reading" id="interest_reading" {% if 'reading' in me.my_interests %}checked{% endif %}>
              <span>Reading</span>
            </label>
          </div>
          <small class="badge-note">Shown on your profile and used to match you with others.</small>
        </div>

        <!-- Save button for Preferences -->
        <div class="save-actions">
          <div class="save-main">
            <button type="submit" class="btn btn-primary">
              <span class="material-icons">publish</span>
              Save & Publish
            </button>
          </div>
        </div>
      </section>
    </div>

    <!-- PROFILE & PHOTOS TAB CONTENT -->
    <div class="tab-content" id="profile-tab">
      <section class="card">
        <div class="section-header" style="display:flex;align-items:center;margin-bottom:8px">
          <h3 style="margin:0">⏱ Profile & Photos</h3>
          <span class="badge badge-pending">
            <span class="material-icons" style="font-size:14px">schedule</span>
            Requires Review
          </span>
        </div>

        <!-- Profile Photo Section -->
        <div class="field">
          <label>Profile photo</label>
          <div style="display:flex;align-items:center;gap:20px;margin-bottom:10px;">
            <div class="photo-upload-trigger" onclick="addProfilePhoto()" id="profile-photo-container" style="width:120px;height:120px;">
              {% with profile_images=me.images.all %}
                {% with first_image=profile_images.0 %}
                  {% if first_image and first_image.image %}
                    <div class="photo-item">
                      <img src="{{ first_image.image.url }}" alt="Current profile photo" style="width:100%;height:100%;object-fit:cover;border-radius:8px;">
                      <button type="button" class="btn-delete" onclick="deletePhoto('{{ first_image.id }}', 'profile')">×</button>
                    </div>
                  {% else %}
                    <div class="upload-icon">+</div>
                    <div class="upload-text">
                      <h4>Add Profile Photo</h4>
                      <p>Click to upload</p>
                    </div>
                  {% endif %}
                {% endwith %}
              {% endwith %}
            </div>
            <button type="button" class="btn btn-muted" onclick="addProfilePhoto()">
              <span class="material-icons">upload</span> 
              {% with profile_images=me.images.all %}
                {% if profile_images.0 %}Change Photo{% else %}Upload Photo{% endif %}
              {% endwith %}
            </button>
          </div>
          <small class="badge-note">This will replace your current profile photo after review</small>
          <div id="profile-photo-error" class="error-message"></div>
          <div id="profile-photo-success" class="success-message"></div>
        </div>

        <!-- Additional Photos Section -->
        <div class="field">
          <label>Additional photos (up to 4)</label>
          <div class="photo-grid" id="additional-photos-container">
            {% for image in me.images.all %}
              {% if not image.is_private and not image.is_primary %}
                <div class="photo-item">
                  <img src="{{ image.image.url }}" alt="Additional photo">
                  <button type="button" class="btn-delete" onclick="deletePhoto('{{ image.id }}', 'additional')">×</button>
                </div>
              {% endif %}
            {% endfor %}
            
            {% with public_images=me.images.all %}
              {% with public_count=0 %}
                {% for image in public_images %}
                  {% if not image.is_private and not image.is_primary %}
                    {% with public_count=public_count|add:1 %}{% endwith %}
                  {% endif %}
                {% endfor %}
                {% if public_count < 4 %}
                  <div class="photo-upload-trigger" onclick="addAdditionalPhoto()">
                    <div class="upload-icon">+</div>
                    <div class="upload-text">
                      <h4>Add Photo</h4>
                      <p>Click to upload</p>
                    </div>
                  </div>
                {% endif %}
              {% endwith %}
            {% endwith %}
          </div>
          <div class="photo-count">
            {% with public_images=me.images.all %}
              {% with public_count=0 %}
                {% for image in public_images %}
                  {% if not image.is_private and not image.is_primary %}
                    {% with public_count=public_count|add:1 %}{% endwith %}
                  {% endif %}
                {% endfor %}
                {{ public_count }}/4 additional photos
              {% endwith %}
            {% endwith %}
          </div>
        </div>

        <!-- Private Photos Section -->
        <div class="field">
          <label>Private photos (up to 4, blurred to others)</label>
          <div class="photo-grid" id="private-photos-container">
            {% for image in me.images.all %}
              {% if image.is_private %}
                <div class="photo-item">
                  <img src="{{ image.image.url }}" alt="Private photo">
                  <button type="button" class="btn-delete" onclick="deletePhoto('{{ image.id }}', 'private')">×</button>
                </div>
              {% endif %}
            {% endfor %}
            
            {% with private_images=me.images.all %}
              {% with private_count=0 %}
                {% for image in private_images %}
                  {% if image.is_private %}
                    {% with private_count=private_count|add:1 %}{% endwith %}
                  {% endif %}
                {% endfor %}
                {% if private_count < 4 %}
                  <div class="photo-upload-trigger" onclick="addPrivatePhoto()">
                    <div class="upload-icon">+</div>
                    <div class="upload-text">
                      <h4>Add Private Photo</h4>
                      <p>Click to upload</p>
                    </div>
                  </div>
                {% endif %}
              {% endwith %}
            {% endwith %}
          </div>
          <div class="photo-count">
            {% with private_images=me.images.all %}
              {% with private_count=0 %}
                {% for image in private_images %}
                  {% if image.is_private %}
                    {% with private_count=private_count|add:1 %}{% endwith %}
                  {% endif %}
                {% endfor %}
                {{ private_count }}/4 private photos
              {% endwith %}
            {% endwith %}
          </div>
        </div>

        <!-- Text Content Fields -->
        <div class="grid-2" style="margin-top:20px">
          <div class="field">
            <label for="headline">Headline</label>
            <input id="headline" name="headline" placeholder="Short tagline" value="{{ me.headline|default:'' }}">
            <small class="badge-note">Will be reviewed before going live</small>
          </div>

          <div class="field">
            <label for="location">Location</label>
            <input id="location" name="location" placeholder="Suburb, City - e.g. Bondi, Sydney" value="{{ me.location|default:'' }}">
            <small class="badge-note">Be specific - this helps find matches nearby</small>
          </div>

          <div class="field" style="grid-column:1/-1">
            <label for="about">About me</label>
            <textarea id="about" name="about" rows="6" placeholder="Tell people about you...">{{ me.about|default:'' }}</textarea>
            <small class="badge-note">Will be reviewed before going live</small>
          </div>
        </div>

        <!-- Save button for Profile & Photos -->
        <div class="save-actions">
          <div class="save-main">
            <button type="submit" class="btn btn-primary">
              <span class="material-icons">send</span>
              Submit for Review
            </button>
          </div>
        </div>
      </section>
    </div>
  </form>
</main>

<script>
// SIMPLE TAB SYSTEM
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab') + '-tab';
            
            // Remove active class from all buttons and contents
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to current button and content
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
});

// SIMPLE PHOTO UPLOAD FUNCTIONS
function addProfilePhoto() {
    triggerFileInput('profile');
}

function addAdditionalPhoto() {
    const additionalCount = document.querySelectorAll('#additional-photos-container .photo-item').length;
    if (additionalCount >= 4) {
        alert('Maximum 4 additional photos allowed');
        return;
    }
    triggerFileInput('additional');
}

function addPrivatePhoto() {
    const privateCount = document.querySelectorAll('#private-photos-container .photo-item').length;
    if (privateCount >= 4) {
        alert('Maximum 4 private photos allowed');
        return;
    }
    triggerFileInput('private');
}

function triggerFileInput(photoType) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(e) {
        if (e.target.files && e.target.files[0]) {
            uploadPhotoDirect(e.target.files[0], photoType);
        }
    };
    input.click();
}

function uploadPhotoDirect(file, photoType) {
    const statusElement = document.getElementById('profile-photo-error');
    const successElement = document.getElementById('profile-photo-success');
    
    statusElement.textContent = '';
    successElement.textContent = 'Uploading photo...';
    
    const formData = new FormData();
    formData.append('image', file);
    formData.append('image_type', photoType);

    fetch('/api/upload-profile-image/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCSRFToken(),
        },
        body: formData,
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Upload failed with status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            successElement.textContent = 'Photo uploaded successfully! Refreshing...';
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            throw new Error(data.error || 'Upload failed');
        }
    })
    .catch(error => {
        console.error('Upload error:', error);
        successElement.textContent = '';
        statusElement.textContent = `Upload failed: ${error.message}`;
    });
}

// Photo deletion function
function deletePhoto(imageId, photoType) {
    if (!confirm('Are you sure you want to delete this photo? This action cannot be undone.')) {
        return;
    }

    const deleteBtn = event.target;
    const originalText = deleteBtn.innerHTML;
    deleteBtn.disabled = true;
    deleteBtn.innerHTML = '...';
    
    fetch(`/api/delete-image/${imageId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCSRFToken(),
            'Content-Type': 'application/json',
        },
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Delete failed with status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            window.location.reload();
        } else {
            throw new Error(data.error || 'Delete failed');
        }
    })
    .catch(error => {
        console.error('Delete error:', error);
        deleteBtn.disabled = false;
        deleteBtn.innerHTML = originalText;
        alert(`Delete failed: ${error.message}`);
    });
}

// Helper function to get CSRF token
function getCSRFToken() {
    const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
    return csrfInput ? csrfInput.value : '';
}

// Form submission handling
document.getElementById('profileForm').addEventListener('submit', function(e) {
    const submitButtons = this.querySelectorAll('button[type="submit"]');
    submitButtons.forEach(button => {
        button.disabled = true;
        button.innerHTML = '<span class="material-icons">hourglass_empty</span> Saving...';
    });
});
</script>
{% endblock %}
