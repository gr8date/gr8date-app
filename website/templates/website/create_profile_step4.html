{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Create Profile - Step 4 - Synergy</title>
<meta name="description" content="Create your elite dating profile - Step 4: Final confirmation and consents." />
<link href="https://fonts.googleapis.com/css2?family=Allura&display=swap" rel="stylesheet">

<style>
  :root {
    --brand: #cdad7c;
    --brand-dark: #a88a5a;
    --brand-light: #e8d8b8;
    --brand-soft: rgba(205, 173, 119, 0.18);
    --brand-glow: rgba(205, 173, 119, 0.32);
    --bg: #050507;
    --bg-card: rgba(18, 18, 20, 0.96);
    --border-subtle: rgba(205, 173, 119, 0.34);
    --border-soft: rgba(255, 255, 255, 0.08);
    --text: #ffffff;
    --text-muted: #a0a0a5;
    --text-soft: #8b8b90;
    --text-gold: #cdad7c;
    --error: #ff6b6b;
    --radius-card: 24px;
    --shadow-soft: 0 26px 50px rgba(0, 0, 0, 0.7);
  }

  * { box-sizing:border-box; margin:0; padding:0; }

  body {
    background: radial-gradient(circle at top left, #2a2a30 0, #050507 45%, #000 100%);
    color: var(--text);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    line-height: 1.7;
    min-height: 100vh;
    overflow-x: hidden;
  }

  #gold-particles {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
  }

  .premium-header {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(5, 5, 7, 0.96);
    backdrop-filter: blur(18px);
    border-bottom: 1px solid rgba(205, 173, 119, 0.3);
    z-index: 1000;
  }

  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0.9rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .script-logo {
    font-family: 'Allura', cursive;
    font-size: 42px;
    font-weight: 400;
    letter-spacing: 1px;
    color: #CDAD7F;
    text-decoration: none;
    text-shadow: 1px 1px 10px rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  .script-logo:hover {
    transform: scale(1.05);
    text-shadow: 1px 1px 15px rgba(255, 255, 255, 0.2);
  }

  .progress-container {
    max-width: 1100px;
    margin: 96px auto 2rem;
    padding: 0 1.5rem;
  }

  .progress-bar {
    background: rgba(255, 255, 255, 0.06);
    height: 8px;
    border-radius: 999px;
    overflow: hidden;
    border: 1px solid rgba(205, 173, 119, 0.42);
    margin-bottom: 0.6rem;
  }

  .progress-fill {
    height: 100%;
    width: 100%; /* Final step */
    background: linear-gradient(90deg, var(--brand-light), var(--brand-dark));
    box-shadow: 0 0 18px rgba(205, 173, 119, 0.55);
    border-radius: 999px;
  }

  .progress-text {
    text-align:center;
    font-size:0.86rem;
    letter-spacing:0.18em;
    text-transform:uppercase;
    color:var(--text-muted);
  }

  .profile-create-container {
    max-width:1100px;
    margin:0 auto 3rem;
    padding:0 1.5rem 3rem;
  }

  .create-card {
    background: radial-gradient(circle at top left, rgba(255,255,255,0.04) 0, rgba(7,7,10,0.96) 40%, rgba(0,0,0,0.98) 100%);
    border-radius:var(--radius-card);
    padding:2.8rem 2.6rem 2.7rem;
    border:1px solid var(--border-subtle);
    box-shadow:var(--shadow-soft), 0 0 60px rgba(205, 173, 119, 0.15);
    position:relative;
    overflow:hidden;
  }

  .create-card::before {
    content:'';
    position:absolute;
    inset:-40%;
    background:radial-gradient(circle at top, rgba(205, 173, 119, 0.14), transparent 60%);
    opacity:0.7;
    pointer-events:none;
    z-index:-1;
  }

  .section-header {
    margin-bottom:2.2rem;
    text-align:center;
  }

  .section-title {
    font-size:2.1rem;
    font-weight:300;
    letter-spacing:0.14em;
    text-transform:uppercase;
    color:#f9f9fa;
    margin-bottom:0.4rem;
  }

  .section-title span {
    color:var(--text-gold);
    font-weight:500;
  }

  .section-subtitle {
    color:var(--text-muted);
    font-size:0.98rem;
    max-width:540px;
    margin:0 auto;
  }

  .highlight-box {
    margin-bottom:2rem;
    padding:1.2rem 1.3rem;
    border-radius:18px;
    background:rgba(255,255,255,0.02);
    border:1px solid rgba(205, 173, 119, 0.35);
    font-size:0.92rem;
    color:var(--text-soft);
  }

  .highlight-title {
    font-size:0.9rem;
    text-transform:uppercase;
    letter-spacing:0.15em;
    color:var(--text-gold);
    margin-bottom:0.45rem;
  }

  .form-section { margin-bottom:2.1rem; }

  .form-group { margin-bottom:1.5rem; }

  .form-label {
    display:block;
    font-size:0.95rem;
    text-transform:uppercase;
    letter-spacing:0.12em;
    color:var(--text-gold);
    margin-bottom:0.55rem;
    font-weight:600;
  }

  .required {
    color:var(--error);
    margin-left:0.1rem;
  }

  .form-select,
  .form-input {
    width:100%;
    padding:0.85rem 1rem;
    border-radius:18px;
    border:1px solid var(--border-soft);
    background:rgba(3,3,5,0.9);
    color:var(--text);
    font-size:0.95rem;
    outline:none;
    transition:border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
  }

  .form-input::placeholder {
    color:#63636a;
  }

  .form-input:focus,
  .form-select:focus {
    border-color:var(--text-gold);
    box-shadow:0 0 0 1px rgba(205, 173, 119, 0.55);
    background:rgba(5,5,9,0.98);
  }

  .form-grid {
    display:grid;
    grid-template-columns:minmax(0,1fr) minmax(0,1fr);
    gap:1.4rem 1.6rem;
  }

  .form-tip {
    font-size:0.85rem;
    color:var(--text-soft);
    margin-top:0.4rem;
  }

  .pill-hint {
    display:inline-flex;
    align-items:center;
    gap:0.5rem;
    background:rgba(255,255,255,0.03);
    border-radius:999px;
    padding:0.35rem 0.9rem;
    border:1px solid rgba(255,255,255,0.06);
    font-size:0.8rem;
    color:var(--text-soft);
  }

  .checkbox-row {
    display:flex;
    align-items:flex-start;
    gap:0.65rem;
    font-size:0.9rem;
    color:var(--text-soft);
  }

  .checkbox-row input[type="checkbox"] {
    margin-top:0.1rem;
    width:18px;
    height:18px;
    border-radius:4px;
    border:1px solid var(--border-soft);
    background:rgba(3,3,5,0.9);
    appearance:none;
    cursor:pointer;
    position:relative;
  }

  .checkbox-row input[type="checkbox"]:checked {
    border-color:var(--text-gold);
    background:linear-gradient(135deg, var(--brand-light), var(--brand-dark));
  }

  .checkbox-row input[type="checkbox"]::after {
    content:'';
    position:absolute;
    top:3px;
    left:5px;
    width:7px;
    height:11px;
    border-right:2px solid #000;
    border-bottom:2px solid #000;
    transform:rotate(40deg);
    opacity:0;
  }

  .checkbox-row input[type="checkbox"]:checked::after {
    opacity:1;
  }

  .checkbox-label-strong {
    color:#f4f4f6;
    font-weight:500;
  }

  /* ERROR STYLING */
  .form-group.field-error .checkbox-row input[type="checkbox"],
  .form-group.field-error .form-input,
  .form-group.field-error .form-select {
    border-color:var(--error);
    box-shadow:0 0 0 1px rgba(255, 107, 107, 0.5);
  }

  .form-group.field-error .form-label {
    color:var(--error);
  }

  .form-error-summary {
    margin-top:0.6rem;
    margin-bottom:0.6rem;
    padding:0.7rem 1rem;
    border-radius:999px;
    font-size:0.86rem;
    border:1px solid rgba(255, 107, 107, 0.6);
    background:rgba(255, 107, 107, 0.08);
    color:var(--error);
    text-align:right;
    display:none;
  }

  .form-actions {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:1.8rem;
    padding-top:1.6rem;
    border-top:1px solid rgba(205, 173, 119, 0.35);
  }

  .btn {
    padding:0.75rem 1.7rem;
    border-radius:999px;
    border:none;
    font-size:0.92rem;
    font-weight:600;
    cursor:pointer;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:0.5rem;
    transition:all 0.25s ease;
  }

  .btn-secondary {
    background:transparent;
    color:var(--text-soft);
    border:1px solid rgba(205, 173, 119, 0.5);
  }

  .btn-secondary:hover {
    color:var(--text-gold);
    border-color:var(--text-gold);
    box-shadow:0 0 18px rgba(205, 173, 119, 0.35);
    transform:translateY(-1px);
  }

  .btn-primary {
    background:linear-gradient(135deg, var(--brand-light), var(--brand-dark));
    color:#000;
    box-shadow:0 14px 28px rgba(0,0,0,0.7);
  }

  .btn-primary:hover {
    transform:translateY(-1px);
    box-shadow:0 18px 32px rgba(0,0,0,0.8);
  }

  @media (max-width:768px) {
    .nav-container { padding:0.8rem 1rem; }
    .script-logo { font-size:34px; }
    .progress-container { margin-top:82px; }
    .create-card { padding:2.1rem 1.6rem 2.1rem; border-radius:18px; }
    .form-grid { grid-template-columns:minmax(0,1fr); }
    .form-actions {
      flex-direction:column-reverse;
      align-items:stretch;
      gap:0.8rem;
    }
    .btn { width:100%; justify-content:center; }
  }
</style>
</head>
<body>
  <div id="gold-particles"></div>

  <header class="premium-header">
    <div class="nav-container">
      <a href="{% url 'index' %}" class="script-logo">Synergy</a>
    </div>
  </header>

  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
    <div class="progress-text">Step 4 of 4: Final Confirmation</div>
  </div>

  <main class="profile-create-container">
    <div class="create-card">
      <div class="section-header">
        <h1 class="section-title"><span>Final Step</span> • Confirm & Complete</h1>
        <p class="section-subtitle">
          A final check to ensure your profile reflects you accurately, and that we’re aligned on safety, discretion and expectations.
        </p>
      </div>

      <div class="highlight-box">
        <div class="highlight-title">Before You Continue</div>
        <p>
          Once you complete this step, your profile will be available for review and discovery within the Synergy community.
          You can edit and refine your details at any time from your profile settings.
        </p>
      </div>

      <form id="profileFormStep4" method="post">
        {% csrf_token %}

        <!-- Connection Preferences – optional -->
        <section class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Preferred Communication Style</label>
              <select class="form-select" id="commStyle" name="communication_style">
                <option value="">Select (optional)</option>
                <option value="messages_only">Messages on Synergy only</option>
                <option value="messages_then_phone">Messages first, phone once comfortable</option>
                <option value="open_phone_exchange">Open to exchanging phone details when there’s rapport</option>
              </select>
              <div class="form-tip">
                This simply sets expectations. You always control when/if you share additional contact details.
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Ideal First Connection</label>
              <select class="form-select" id="firstConnection" name="first_connection">
                <option value="">Select (optional)</option>
                <option value="coffee_or_drink">A relaxed coffee or drink</option>
                <option value="dinner">Dinner at a favourite restaurant</option>
                <option value="experience">An experience (gallery, show, event)</option>
                <option value="open_to_discuss">Open to discuss together</option>
              </select>
            </div>
          </div>
        </section>

        <!-- Safety & Consents – required -->
        <section class="form-section">
          <div class="form-group" id="fg_over18">
            <label class="form-label">Age Confirmation <span class="required">*</span></label>
            <div class="checkbox-row">
              <input type="checkbox" id="confirm18" name="confirm_over_18" required>
              <label for="confirm18">
                <span class="checkbox-label-strong">I confirm that I am 18 years of age or older.</span><br>
                I understand that Synergy is exclusively for adults and that providing false information may result in the suspension of my account.
              </label>
            </div>
          </div>

          <div class="form-group" id="fg_terms">
            <label class="form-label">Terms & Privacy <span class="required">*</span></label>
            <div class="checkbox-row">
              <input type="checkbox" id="agreeTerms" name="agree_terms" required>
              <label for="agreeTerms">
                <span class="checkbox-label-strong">I agree to the Synergy Terms of Service and Privacy Policy.</span><br>
                I have read and accept the&nbsp;
                <a href="{% url 'terms' %}" style="color:var(--text-gold);text-decoration:none;">Terms of Service</a>
                &nbsp;and&nbsp;
                <a href="{% url 'privacy' %}" style="color:var(--text-gold);text-decoration:none;">Privacy Policy</a>.
              </label>
            </div>
            <div class="form-tip">
              We take discretion seriously. Your details are handled in line with our privacy commitments.
            </div>
          </div>
        </section>

        <!-- NO marketing / visibility toggles here; that will live in Edit Profile / Account Settings -->

        <div id="formErrorSummary" class="form-error-summary" style="display:none;">
          Please complete the highlighted fields to finish your profile.
        </div>

        <div class="form-actions">
          <a href="{% url 'create_profile_step3' %}" class="btn btn-secondary">Back to Step 3</a>
          <button type="submit" class="btn btn-primary">Finish & View Profile</button>
        </div>
        <p style="margin-top:1rem;font-size:0.9rem;color:var(--text-muted);text-align:right;">
          You can update your details or preferences at any time from your profile settings.
        </p>
      </form>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Gold particles (same pattern as other steps)
      function createGoldParticles() {
        const container = document.getElementById('gold-particles');
        for (let i = 0; i < 12; i++) {
          const p = document.createElement('div');
          p.className = 'gold-particle';
          p.style.left = Math.random() * 100 + 'vw';
          p.style.top = Math.random() * 100 + 'vh';
          p.style.animationDelay = (Math.random() * 6) + 's';
          container.appendChild(p);
        }
      }

      const style = document.createElement('style');
      style.textContent = `
        .gold-particle {
          position: absolute;
          width: 3px;
          height: 3px;
          background: radial-gradient(circle, #ffe6b3 0%, #cdad7c 40%, transparent 70%);
          border-radius: 50%;
          animation: floatParticle 6s ease-in-out infinite;
          opacity: 0.6;
          pointer-events: none;
        }
        @keyframes floatParticle {
          0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
          50% { opacity: 0.9; }
          25%, 75% { transform: translateY(-20px) translateX(12px); }
        }
      `;
      document.head.appendChild(style);
      createGoldParticles();

      const form = document.getElementById('profileFormStep4');
      const errorSummary = document.getElementById('formErrorSummary');

      const confirm18 = document.getElementById('confirm18');
      const agreeTerms = document.getElementById('agreeTerms');
      const fgOver18 = document.getElementById('fg_over18');
      const fgTerms = document.getElementById('fg_terms');

      function clearErrors() {
        [fgOver18, fgTerms].forEach(group => {
          if (group) group.classList.remove('field-error');
        });
        if (errorSummary) errorSummary.style.display = 'none';
      }

      function validateOnSubmit() {
        clearErrors();
        let hasError = false;
        let firstError = null;

        if (!confirm18.checked) {
          fgOver18.classList.add('field-error');
          hasError = true;
          if (!firstError) firstError = fgOver18;
        }

        if (!agreeTerms.checked) {
          fgTerms.classList.add('field-error');
          hasError = true;
          if (!firstError) firstError = fgTerms;
        }

        if (hasError) {
          if (errorSummary) errorSummary.style.display = 'block';
          if (firstError && firstError.scrollIntoView) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }

        return !hasError;
      }

      if (form) {
        form.addEventListener('submit', function(e) {
          if (!validateOnSubmit()) {
            e.preventDefault();
          }
        });

        [confirm18, agreeTerms].forEach(input => {
          input.addEventListener('change', () => {
            if (input === confirm18 && confirm18.checked) {
              fgOver18.classList.remove('field-error');
            }
            if (input === agreeTerms && agreeTerms.checked) {
              fgTerms.classList.remove('field-error');
            }
            if (![fgOver18, fgTerms].some(g => g.classList.contains('field-error')) && errorSummary) {
              errorSummary.style.display = 'none';
            }
          });
        });
      }
    });
  </script>
</body>
</html>

